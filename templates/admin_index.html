<!-- 
@auther: 13716
@date:   2019/10/24-22:53
@ide:    PyCharm
@name:   admin_index.html
-->
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>控制台</title>
    <script src="https://cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
    <link href="https://cdn.bootcss.com/twitter-bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.bootcss.com/twitter-bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src="https://cdn.bootcss.com/axios/0.19.0/axios.min.js"></script>
    <script src="https://cdn.bootcss.com/vue/2.6.10/vue.min.js"></script>
    <script src="https://cdn.bootcss.com/echarts/4.3.0/echarts.min.js"></script>
    <link rel="stylesheet" href="{% static "css/index.css" %}">
    <link rel="stylesheet" href="{% static "css/admin_index.css" %}">
</head>
<body>
    <nav class="navbar navbar-inverse" id="header">

        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#header_link" aria-expanded="false">
                    <span class="sr-only">导航栏</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>

                <a class="navbar-brand" href="/">
                    <span class="glyphicon glyphicon-bold"></span>
                </a>
            </div>

            <div class="collapse navbar-collapse" id="header_link">
                <form class="navbar-form navbar-left">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="搜索">
                    </div>
                    <button type="submit" class="btn btn-primary">搜索</button>
                </form>

                <ul class="nav navbar-nav navbar-right" v-if="login">
                    <li><img v-bind:src="icon" alt="用户头像" class="icon"></li>
                    <li class="drop-box">
                        <a href="#">{% templatetag openvariable  %} username {% templatetag closevariable  %}</a>
                        <div class="drop-content">
                            <a class="admin_link" @click="to_control">控制台</a>
                            <a class="common-link" @click="logout">注销</a>
                        </div>
                    </li>

                </ul>
                <ul class="nav navbar-nav navbar-right" v-else>
                    <li><a href="#" @click="login_btn">登陆</a></li>
                    <li><a href="#">注册</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <aside class="col-lg-2 visible-md-block visible-lg-block col-md-4" id="menu">
        <div class="container-fluid list-group">
            <div v-for="element in model_list" class="list-group-item my-item">
                {% templatetag openvariable  %}
                    element
                {% templatetag closevariable  %}
            </div>
        </div>

    </aside>
    <section class="col-lg-10 col-md-8 col-sm-12" id="content">
        <h3>欢迎来到个人信息管理中心</h3>

    </section>
    <script>
        let header = new Vue({
            el: "#header",
            data: {
                login: false,
                icon: "",
                username: "",
                is_admin: false
            },
            created() {
                let token = this.get_token();
                if (token) {
                    axios.get("/login/", {
                        params: {
                            token: token
                        }
                    })
                    .then(response => {
                        if (response.data.status) {
                            this.login = true;
                            this.icon = response.data.user_icon;
                            this.username = response.data.username;
                            this.is_admin = response.data.is_admin;
                        }
                    })
                    .catch( error => {
                        this.login = false;
                        window.location.href = "/";
                    })
                }
            },
            methods: {
                login_btn() {
                    login_modal.show = true;
                },
                get_token() {
                    let token;
                    let value = document.cookie.split(";");
                    for (let i = 0; i < value.length; i++) {
                        let message = value[i].split("=");
                        if (message[0].trim() === "token") {
                            token = message[1];
                            return token;
                        }
                    }
                    return false;
                },
                logout() {
                    let value = document.cookie.split(";");
                    for (let i = 0; i < value.length; i++) {
                        let message = value[i].split("=");
                        if (message[0].trim() === "token") {
                            document.cookie = "token=expires=Thu, 01 Jan 1970 00:00:00 GMT";
                        }
                    }
                    window.location.reload();
                },
                to_control() {
                    window.location.href = "/admin/?token=" + this.get_token();
                }
            }
        });
        let menu = new Vue({
            el: "#menu",
            data: {
                model_list: []
            },
            created() {
                let token = this.get_token();
                if (token) {
                    axios.get("/admin/model/", {
                        params: {
                            token: token
                        }
                    })
                    .then(response => {
                        console.log(response);
                        for (let i in response.data.model_data) {
                            this.model_list.push(i);
                        }
                    })
                }

            },
            methods: {
                get_token() {
                    let token;
                    let value = document.cookie.split(";");
                    for (let i = 0; i < value.length; i++) {
                        let message = value[i].split("=");
                        if (message[0].trim() === "token") {
                            token = message[1];
                            return token;
                        }
                    }
                    return false;
                },
            }
        });

    </script>
</body>
</html>